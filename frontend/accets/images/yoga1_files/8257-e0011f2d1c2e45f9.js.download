(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8257],{98257:function(e,t,n){"use strict";n.d(t,{Z:function(){return J},F:function(){return V}});var r=n(47568),i=n(26042),a=n(69396),l=n(29815),s=n(20414),o=n(85893),u=n(2337),d=n(67294),c=n(58533),m=n(36589),f=n(40006),v=n(11163),h=n(13344),p=n(14108),g=n(59830),x=n(9669),b=n.n(x),y=n(33299),j=function(e){var t,n,a,o=e.initialImages,u=e.initialCursor,c=e.options,m=e.sortBy,f=e.filter,v=e.dateFilter,h=(0,d.useState)(o),p=h[0],x=h[1],j=(0,d.useState)(u),w=j[0],C=j[1],Z=(0,y.useSession)(),k=(0,d.useState)(!1),N=k[0],I=k[1],M=(0,d.useRef)({sortBy:m,filter:f,dateFilter:v}),S=(0,d.useCallback)((a=(0,r.Z)(function(e){var t,n,r,a,l,o;return(0,s.__generator)(this,function(r){switch(r.label){case 0:return[4,b().get(c.url,{params:(0,i.Z)({limit:g.NM,cursor:e,userId:null==Z?void 0:null===(t=Z.data)||void 0===t?void 0:null===(n=t.user)||void 0===n?void 0:n.id},c.params)})];case 1:return[2,{newImages:l=(a=r.sent().data).images,newCursor:a.cursor,nasMoreImages:void 0!==e}]}})}),function(e){return a.apply(this,arguments)}),[c.params,c.url,null==Z?void 0:null===(t=Z.data)||void 0===t?void 0:null===(n=t.user)||void 0===n?void 0:n.id]);(0,d.useEffect)(function(){var e,t,n,i=!1,a=(n=(0,r.Z)(function(){var e,t,n;return(0,s.__generator)(this,function(r){switch(r.label){case 0:return I(!0),[4,S(0)];case 1:return t=(e=r.sent()).newImages,n=e.newCursor,i||(n&&C(n),x(t),I(!1)),[2]}})}),function(){return n.apply(this,arguments)});return M.current.sortBy!==m&&(M.current.sortBy=null,a()),M.current.filter!==f&&(M.current.filter=null,a()),((null===(e=M.current.dateFilter)||void 0===e?void 0:e.start)!==(null==v?void 0:v.start)||(null===(t=M.current.dateFilter)||void 0===t?void 0:t.end)!==(null==v?void 0:v.end))&&(M.current.dateFilter=null,a()),function(){i=!0}},[m,f,null==v?void 0:v.start,null==v?void 0:v.end]);var E=(0,d.useCallback)((0,r.Z)(function(){var e,t,n;return(0,s.__generator)(this,function(r){switch(r.label){case 0:return[4,S(w)];case 1:return t=(e=r.sent()).newImages,(n=e.newCursor)&&C(n),setTimeout(function(){return x(function(e){return(0,l.Z)(e).concat((0,l.Z)(t))})},0),[2,t]}})}),[w,S]);return{images:p,getMoreImages:E,haveMoreImages:void 0!==w,setImages:x,showEmptyImages:N}},w=n(40247),C=n(8683),Z=n(65638),k=n(8654),N=n(69669),I=n(94978),M=n.n(I);function S(e){var t=e.deleteImages,n=e.numSelected,r=(0,N.d)().closeModal,i=(0,w.bJ)();return(0,o.jsxs)(k.Z,{onSubmit:function(e){e.preventDefault(),t()},children:[(0,o.jsx)(k.Z.Header,{children:(0,o.jsx)(k.Z.HeaderTitle,{children:"Are you sure you want to delete ".concat(n," ").concat(n>1?"images":"image","?")})}),(0,o.jsx)(k.Z.Body,{children:"Deleting images will permanently remove them and you will not be able to recover them later."}),(0,o.jsxs)(k.Z.Footer,{children:[(0,o.jsx)(k.Z.Cancel,{onClick:r,disabled:i}),(0,o.jsx)(k.Z.Submit,{className:M().DeleteButton,disabled:i,children:i?(0,o.jsx)(Z.ZP,{smallest:!0,flex:!0}):"Delete"})]})]})}function E(e){var t=e.error,n=(0,N.d)().closeModal;return(0,o.jsxs)(k.Z,{onSubmit:function(e){e.preventDefault(),n()},children:[(0,o.jsx)("div",{className:"flex px-8"}),(0,o.jsx)(k.Z.Header,{children:(0,o.jsx)(k.Z.HeaderTitle,{children:"Cannot complete download"})}),(0,o.jsx)(k.Z.Body,{children:t}),(0,o.jsx)(k.Z.Footer,{children:(0,o.jsx)(k.Z.Submit,{children:"Okay"})})]})}var _=n(86010),L=n(13173),P=n(10435),F=n(28277),T=n(62469),D=n(76799),W=n(34206);function B(e){var t=e.disabled,n=(0,w.a5)(),r=(0,d.useState)(null),i=r[0],a=r[1],l=(0,w.dW)(function(e){return e.images.every(function(e){return!e.private})}),s=(0,w.dW)(function(e){return e.images.every(function(e){return e.private})}),u=!(0,W.Z)();return(0,o.jsx)(F.t3.MenubarRoot,{children:(0,o.jsxs)(P.v2,{children:[(0,o.jsx)(F.t3.MenubarTrigger,{className:"primary text-gray-50 w-[36px] hover:bg-gray-80 rounded-md disabled:pointer-events-none disabled:cursor-default flex items-center justify-center",disabled:t,children:(0,o.jsx)(T.AjK,{className:"w-4 h-4 "})}),(0,o.jsx)(P.h_,{children:(0,o.jsxs)(F.t3.MenubarContent,{align:"end",side:window.innerWidth>1100?"right":"top",sideOffset:15,alignOffset:window.innerWidth>1100?-27:-10,children:[(0,o.jsxs)(F.t3.MenubarItem,{disabled:n||l,className:"flex items-center disabled:text-gray-50",onClick:function(){a("public"),w.dW.getState().setPrivacy(!1)},children:["Make public"," ",n&&"public"===i&&(0,o.jsx)(Z.ZP,{smallest:!0,flex:!0,className:"ml-2"})]}),(0,o.jsx)(D._,{open:!!u&&!n&&!s&&void 0,label:"This feature is only available to Pro users",mixpanelKey:"Change Privacy (Profile bulk action)",alignOffset:-25,sideOffset:10,children:(0,o.jsxs)(F.t3.MenubarItem,{disabled:n||s,className:"flex items-center disabled:text-gray-50",onClick:function(){u||(a("private"),w.dW.getState().setPrivacy(!0))},children:["Make private"," ",n&&"private"===i&&(0,o.jsx)(Z.ZP,{smallest:!0,flex:!0,className:"ml-2"})]})})]})})]})})}function A(e){e.selectAll,e.allAreSelected;var t=e.allowEdits,n=void 0===t||t,r=e.deletedCallback,i=(0,w.dW)(function(e){return e.active}),a=(0,w.Le)(),l=(0,w.uh)(),s=(0,N.d)(),u=s.setModalContent,d=s.closeModal,c=s.isModalOpen,m=function(){u((0,o.jsx)(S,{deleteImages:function(){var e=w.dW.getState(),t=e.images.map(function(e){return e.id});setTimeout(function(){r(t),d()},300),e.delete()},numSelected:a}))},f=function(e){u((0,o.jsx)(E,{error:e}))};return(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)("div",{className:(0,_.Z)("flex fixed min-w-[600px] left-[50%] bg-gray-90 p-[10px] text-sm font-medium rounded-[10px] items-center z-[".concat(C.KN.SELECT_POPOVER,"]"),"border-[1px] border-gray-80","transition transition-all translate-y-full ease-in-out",i?"bottom-8":"-bottom-20"),style:{transform:"translate(-50%, 0)",boxShadow:"0px 0px 16px 0px rgba(0, 0, 0, 0.56), 0px 4px 24px 0px rgba(0, 0, 0, 0.25)"},children:[(0,o.jsxs)("div",{className:"flex items-center ml-1 gap-4 font-semibold text-gray-10",children:[(0,o.jsx)("button",{className:"text-gray-50 hover:bg-gray-80 rounded-md p-1",onClick:w.dW.getState().reset,disabled:l||c,children:(0,o.jsx)(L.Z,{})}),"".concat(a," selected")]}),(0,o.jsx)("div",{className:"flex-grow"}),(0,o.jsxs)("div",{className:"flex gap-2",children:[n&&(0,o.jsx)("button",{className:"marketing-button secondary",onClick:m,disabled:0===a||l||c,children:"Delete"}),(0,o.jsx)("button",{className:"marketing-button primary min-w-[120px]",onClick:function(){w.dW.getState().download(f)},disabled:0===a||l||c,children:l?(0,o.jsx)(Z.ZP,{smallest:!0,flex:!0}):"Download"}),n&&(0,o.jsx)(B,{disabled:0===a||l||c})]})]})})}var O=n(34031),H=n(55043),R=n(837),z=n(41664),q=n.n(z);function K(e){var t,n,r,i,a=e.data,l=(0,R.L)({fallbackData:a});return(0,o.jsx)(q(),{href:"/create",children:(0,o.jsx)("a",{children:(0,o.jsxs)("div",{className:"overflow-hidden p-1 rounded-lg bg-gray-75 relative",children:[(0,o.jsx)("div",{className:"absolute top-0 left-0 z-10 bg-gray-75 text-gray-5 p-2 rounded-br-[7px] text-xs font-590",children:"DAILY THEME"}),(0,o.jsx)("div",{className:"relative",children:(0,o.jsx)("img",{src:null==l?void 0:null===(t=l.data)||void 0===t?void 0:t.imageUrl,className:"aspect-square h-full w-full relative rounded-[4px]",alt:null==l?void 0:null===(n=l.data)||void 0===n?void 0:n.title})}),(0,o.jsxs)("div",{className:"z-10 relative p-3",children:[(0,o.jsx)("h2",{className:"text-gray-5 font-bold text-sm",children:null==l?void 0:null===(r=l.data)||void 0===r?void 0:r.title}),(0,o.jsx)("p",{className:"text-gray-25 text-sm",children:null==l?void 0:null===(i=l.data)||void 0===i?void 0:i.body})]})]})})})}var V={300:1,440:2,800:3,1200:4,1600:5,3e3:7,3400:8,4e3:9};function J(e){var t,n,g=e.className,x=e.initialImages,b=e.initialCursor,y=e.options,C=e.sortBy,Z=e.filter,k=e.dateFilter,I=e.emptyState,M=e.groupBatchedImages,S=void 0!==M&&M,E=e.hideProfileImages,_=void 0!==E&&E,L=e.scrollThreshold,P=e.showDailyThemeCard,F=e.dailyTheme,T=(0,d.useState)(null),D=T[0],W=T[1],B=(0,d.useState)(!1),R=B[0],z=B[1],q=(0,d.useState)(null),J=q[0],Q=q[1],U=(0,v.useRouter)(),Y="/profile/likes/[id]"===U.pathname,G=j({initialImages:x,initialCursor:b,options:y,sortBy:C,filter:Z,dateFilter:k}),X=G.haveMoreImages,$=G.getMoreImages,ee=G.setImages,et=G.images,en=G.showEmptyImages,er=(0,p.g)().setImageData,ei=(0,N.d)(),ea=ei.isModalOpen,el=ei.closeModal,es=H.t.useUserHasPermission("moderation:images:private"),eo=(0,d.useCallback)((t=(0,r.Z)(function(e,t){var n,r,i,a=arguments;return(0,s.__generator)(this,function(l){return n=!(a.length>2)||void 0===a[2]||a[2],r=a.length>3&&void 0!==a[3]&&a[3],W(t),er(e),i=e.id,U.query.postId=i,r&&U.push(U,"/post/".concat((0,O.Td)(e)),{shallow:!0}),n&&localStorage.setItem("modal-return-to",U.asPath),[2]})}),function(e,n){return t.apply(this,arguments)}),[U,er]),eu=(0,h.Z)(),ed=(0,d.useMemo)(function(){var e=[];return et.forEach(function(t){if(!t.hide){var n=e.find(function(e){return e.id===t.batchId});n?n.images.length<4&&n.images.push(t):e.push({id:S&&t.batchId?t.batchId:t.id,images:[t]})}}),P?[{id:"daily-theme-batch",images:[{id:"daily-theme",isDailyTheme:!0}]},].concat((0,l.Z)(e)):e},[et,S,P]),ec=(0,d.useCallback)((n=(0,r.Z)(function(e){var t,n,r,i,a,l;return(0,s.__generator)(this,function(s){switch(s.label){case 0:if(!(null!==D))return[3,2];if(t=D+e,P&&0===t)return[2];if(n=P?et.length+1:et.length,t>=0&&t<n&&(l=null===(r=ed[t].images)||void 0===r?void 0:r[0],null===(i=ed[t].images)||void 0===i?void 0:null===(a=i[0])||void 0===a?void 0:a.id))return[2,eo(l,t,!1,!0)];if(!(t>=et.length-2))return[3,2];return[4,$()];case 1:s.sent(),s.label=2;case 2:return[2]}})}),function(e){return n.apply(this,arguments)}),[ed,$,et.length,eo,D,P,]);(0,d.useEffect)(function(){return w.dW.getState().reset},[]),(0,d.useEffect)(function(){var e,t,n=(e=(0,r.Z)(function(e){var t;return(0,s.__generator)(this,function(n){switch(null===(t=e.key)||void 0===t?void 0:t.toLowerCase()){case"arrowleft":case"arrowright":if(!(null==U?void 0:U.query.postId))break;ec("ArrowRight"===e.key?1:-1);break;case"shift":console.log("Multi-select: on"),z(!0);break;case"escape":ea?el():w.dW.getState().reset()}return[2]})}),function(t){return e.apply(this,arguments)});document.addEventListener("keydown",n);var i=(t=(0,r.Z)(function(e){var t;return(0,s.__generator)(this,function(n){return(null===(t=e.key)||void 0===t?void 0:t.toLowerCase())==="shift"&&(console.log("Multi-select: off"),z(!1)),[2]})}),function(e){return t.apply(this,arguments)});return document.addEventListener("keyup",i),function(){document.removeEventListener("keydown",n),document.removeEventListener("keyup",i)}},[et,ec,null==U?void 0:U.query.postId,D,ea,el,]),(0,d.useEffect)(function(){var e=function(){return ec(1)},t=function(){return ec(-1)};return document.addEventListener("pai:modal:next",e),document.addEventListener("pai:modal:prev",t),function(){document.removeEventListener("pai:modal:next",e),document.removeEventListener("pai:modal:prev",t)}},[ec]);var em=(0,d.useMemo)(function(){return et.some(function(e){return e.hide})},[et]),ef=function(e,t){ee(function(n){return n.map(function(n){return t.includes(n.id)?(0,a.Z)((0,i.Z)({},n),{hide:e}):n})})},ev=(0,f.Lm)().width,eh=(0,d.useMemo)(function(){return(0,f.QN)(ev,V)},[ev]),ep=(0,w.dW)(function(e){return e.active}),eg=function(){var e=et.map(function(e){return{id:e.id,url:e.url,prompt:e.prompt,private:e.private,publishedFromCanvas:e.fromCanvas}});w.dW.getState().selectAll(e)},ex=(0,w.Le)()===et.length,eb=function(e){var t=e.col;return e.row*eh+t},ey=(0,d.useMemo)(function(){var e=-1,t={0:0,1:0,2:0,3:0,4:0};et.length;var n={};return ed.forEach(function(r){var i=(e+=1)%eh,a=t[i];t[i]+=2===r.images.length?1:2,r.images.forEach(function(e,t){n[e.id]={col:i+([1,3].includes(t)?.5:0),row:a+([0,1].includes(t)?0:1)}})}),n},[ed,et.length,eh,X]),ej=function(e){var t=w.dW.getState();if(!t.downloadLoading&&!t.deleteLoading){if(t.isSelected(e.id))t.deselect(e.id);else{Q(e.id);var n={id:e.id,url:e.url,prompt:e.prompt,private:e.private,publishedFromCanvas:e.fromCanvas};if(R&&t.images.length&&J){if(R){var r=ey[J],i=ey[e.id],a=eb(r),s=eb(i);if(s>a){var o=et.filter(function(e){return!e.hide}).filter(function(e){return eb(ey[e.id])>=a&&eb(ey[e.id])<=s}).map(function(t){return{id:t.id,url:t.url,prompt:t.prompt,private:t.private,publishedFromCanvas:e.fromCanvas}});t.selectAll((0,l.Z)(t.images).concat((0,l.Z)(o.filter(function(e){return!t.images.some(function(t){return t.id===e.id})}))))}else if(s<a){var u=et.filter(function(e){return!e.hide}).filter(function(e){return eb(ey[e.id])>=s&&eb(ey[e.id])<=a}).map(function(t){return{id:t.id,url:t.url,prompt:t.prompt,private:t.private,publishedFromCanvas:e.fromCanvas}});t.selectAll((0,l.Z)(t.images).concat((0,l.Z)(u.filter(function(e){return!t.images.some(function(t){return t.id===e.id})}))))}}}else t.select(n)}}};return eu?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(c.Z,{className:g,dataLength:et.length,next:$,hasMore:X,loader:(0,o.jsx)(o.Fragment,{}),style:{overflow:"visible"},scrollThreshold:void 0===L?.8:L,children:(0,o.jsx)(f.ZP,{columnsCountBreakPoints:V,children:ed.length&&!en?(0,o.jsx)(u.Z,{gutter:"16px",children:ed.map(function(e,t){var n=Math.min(e.images.length,2);return(0,o.jsx)("div",{className:"grid gap-1",style:{gridTemplateColumns:"repeat(".concat(n,", minmax(0, 1fr))")},children:e.images.map(function(e){var r,i,a,l;return e.isDailyTheme?(0,o.jsx)(K,{data:F},"daily-theme-card"):(0,o.jsx)(m.F,{id:e.id,width:e.width,height:e.height,aspectRatio:(null!==(r=e.width)&&void 0!==r?r:1)/(null!==(i=e.height)&&void 0!==i?i:1),prompt:n>1?"":e.prompt,showPrompt:!0,url:e.url,url_jpeg:e.url_jpeg,title:e.title,isPrivate:e.private,createdAt:e.createdAt,source:e.source,user:{id:e.user.id,name:e.user.displayName,avatar:e.user.image},hideImage:_,isLiked:null!==(a=e.userLiked)&&void 0!==a&&a,numLikes:null!==(l=e.likeCount)&&void 0!==l?l:0,fromCanvas:e.fromCanvas,onClick:function(n){if(ep){ej(e);return}R&&(console.log("Multi-select: off [2]"),z(!1)),n.metaKey||R||eo(e,t)},setHidden:ef,forceVisible:em,parent_image_url:e.parent_image_url},e.id)})},e.id)})}):(0,o.jsx)("p",{className:"text-gray-400 p-10",children:I||en||"No images."})})}),(0,o.jsx)(A,{selectAll:eg,allAreSelected:ex,deletedCallback:function(e){return ef(!0,e)},allowEdits:!Y||es})]}):null}},40006:function(e,t,n){"use strict";n.d(t,{Lm:function(){return s},QN:function(){return o}});var r=n(828),i=n(85893),a=n(13344),l=n(67294),s=function(){var e=(0,a.Z)(),t=(0,l.useState)(0),n=t[0],r=t[1],i=(0,l.useCallback)(function(){e&&r(window.innerWidth)},[e]);return(0,l.useLayoutEffect)(function(){if(e)return window.addEventListener("resize",i),i(),function(){return window.removeEventListener("resize",i)}},[e,i]),{width:n,hasMounted:e}};function o(e,t){var n=1;return Object.entries(t).sort(function(e,t){var n=(0,r.Z)(e,1)[0];return parseInt((0,r.Z)(t,1)[0])-parseInt(n)}).some(function(t){var i=(0,r.Z)(t,2),a=i[0],l=i[1];return e>=parseInt(a)&&(n=l,!0)}),n}var u=function(e){var t=e.columnsCountBreakPoints,n=e.children,r=e.className,a=e.style,u=s(),d=u.width,c=u.hasMounted,m=(0,l.useMemo)(function(){return o(d,t)},[t,d]);return(0,i.jsx)("div",{className:r,style:a,children:c?l.Children.map(n,function(e,t){return l.cloneElement(e,{key:t,columnsCount:m})}):null})};t.ZP=u},94978:function(e){e.exports={DeleteButton:"DeleteCanvas_DeleteButton__VYwTJ"}}}]);